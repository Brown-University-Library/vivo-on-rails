<button type="button" class="btn btn-link btn-sm search-toggle-more-categories"
  data-toggle="modal" data-target="#modal_form_<%= facet.name %>"
  title="Show more categories from this facet">
    <small class="glyphicon glyphicon-plus"></small>&nbsp;<span>More…</span>
</button>

<!-- Modal -->
<div id="modal_form_<%= facet.name %>" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title"><%= facet.title %></h4>
      </div>
      <div class="modal-body">
        <% page_num = 0 %>
        <% page_size = 20 %>
        <% page_count = (facet.values.count / page_size).to_i + ((facet.values.count % page_size) == 0 ? 0 : 1) %>
        <% id_prefix = "modal_form_" + facet.name %>
        <a id="<%= id_prefix %>_prev_link" href="javascript:GoPrevPage('<%= facet.name %>');">
          <span id="<%= id_prefix %>_prev_text">« Previous</span>
        </a>
        &nbsp;&nbsp;
        <a id="<%= id_prefix %>_next_link" href="javascript:GoNextPage('<%= facet.name %>');">
          <span id="<%= id_prefix %>_next_text">Next »</span>
        </a>
        <input id="<%= id_prefix %>_page_num" value="1" class="hidden">
        <input id="<%= id_prefix %>_page_count" value="<%= page_count %>" class="hidden">
        <p>&nbsp;&nbsp;</p>

        <% facet.values.each_with_index do |value, index| %>
          <% if (index % page_size) == 0 %>
            <% page_num += 1 %>
            <% div_class = page_num == 1 ? "" : "hidden" %>
            <div id="<%= id_prefix %>_page_<%= page_num.to_s %>" class="<%= div_class %>">
              <ul>
          <% end %>
            <li>
              <span>
                <% if value.remove_url == nil %>
                  <a href="<%= search_url() + "?" + @presenter.search_qs + "&fq=" + facet.to_qs(value.text) %>"><%= value.text %></a>
                <% else %>
                  <%= value.text %>
                  <a href="<%= value.remove_url %>"><span class="glyphicon glyphicon-remove"></span><span class="sr-only">Remove facet <%= value.text %></span></a>
                <% end %>
              </span>
              <span class="categoryCount"><%= value.count %></span>

            <% if ((index+1) % page_size) == 0 || (index+1) == facet.values.count%>
                <!-- close the list for the last item in page (or last item in facets) -->
                </ul>
              </div><!-- page_facet.name -->
            <% end %>
        <% end %>


      </div> <!-- modal body -->
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div> <!-- modal content -->

  </div> <!-- modal-dialog -->
</div> <!-- modal_form -->

<script>
  TooglePrevNextPage("<%= facet.name %>");
</script>
